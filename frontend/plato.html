<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Plato</title>
  <link rel="stylesheet" href="CSS/styles.css">
</head>

  <body>

  <div class="container">

    <button id="btn-volver">Volver</button>

    <h1 id="nombre-plato"></h1>
    <p id="descripcion-plato"></p>
    <p id="precio-plato"></p>
    <p id="tiempo-plato"></p>
    <p id="nivel-plato"></p>

    <h2>Ingredientes</h2>
    <div id="lista-ingredientes"></div>
    <button id="btn-agregar-ingrediente">Agregar Ingrediente</button>

  </div>

    <script>
    const API_PLATOS = "http://localhost:3000/platos";
    const API_INGREDIENTES = "http://localhost:3000/ingredientes";

    const params = new URLSearchParams(window.location.search);
    const platoId = params.get("id");
    const restauranteId = params.get("restaurante_id");

      // Volver al restaurante
    document.getElementById("btn-volver").addEventListener("click", () => {
      window.location.href = `restaurante.html?id=${restauranteId}`;
    });

       // Cargar datos del plato
    async function cargarPlato() {
      try {
        const res = await fetch(`${API_PLATOS}/${platoId}`);
        const p = await res.json();

        document.getElementById("nombre-plato").textContent = p.nombre;
        document.getElementById("descripcion-plato").textContent = p.descripcion;
        document.getElementById("precio-plato").textContent = `Precio: $${p.precio}`;
        document.getElementById("tiempo-plato").textContent = `Tiempo: ${p.tiempo_elaboracion} min`;
        document.getElementById("nivel-plato").textContent = `Nivel: ${p.nivel}`;
      } catch (e) {
        console.error(e);
        alert("Error al cargar plato");
      }
    }

       // Cargar ingredientes del plato
    async function cargarIngredientes() {
      try {
        const res = await fetch(`${API_INGREDIENTES}/plato/${platoId}`);
        const ingredientes = await res.json();

        const contenedor = document.getElementById("lista-ingredientes");
        contenedor.innerHTML = "";

        ingredientes.forEach(i => {
          const div = document.createElement("div");
          div.className = "ingrediente";

          div.innerHTML = `
            <img src="${i.foto_url}" alt="${i.nombre}">
            <div>
              <h3>${i.nombre}</h3>
              <p>Origen: ${i.origen}</p>
              <p>Calorías: ${i.calorias}</p>
              <p>Cantidad: ${i.cantidad}</p>
              <p>Tipo: ${i.tipo}</p>
              <button class="editar" data-id="${i.id}">Editar</button>
              <button class="borrar" data-id="${i.id}">Borrar</button>
            </div>
          `;

          contenedor.appendChild(div);
        });

        // Borrar ingrediente
        document.querySelectorAll(".borrar").forEach(btn => {
          btn.addEventListener("click", async () => {
            if (confirm("¿Querés borrar este ingrediente?")) {
              await fetch(`${API_INGREDIENTES}/${btn.dataset.id}`, {
                method: "DELETE"
              });
              cargarIngredientes();
            }
          });
        });

        // Editar ingrediente
        document.querySelectorAll(".editar").forEach(btn => {
          btn.addEventListener("click", () => {
            window.location.href =
              `editar-ingrediente.html?id=${btn.dataset.id}&plato_id=${platoId}&restaurante_id=${restauranteId}`;
          });
        });

      } catch (e) {
        console.error(e);
        alert("Error al cargar ingredientes");
      }
    }

    document.getElementById("btn-agregar-ingrediente").addEventListener("click", () => {
      window.location.href =
        `agregar-ingrediente.html?plato_id=${platoId}&restaurante_id=${restauranteId}`;
    });

    cargarPlato();
    cargarIngredientes();
  </script>

</body>
</html>
